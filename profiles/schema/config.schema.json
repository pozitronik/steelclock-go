{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://steelclock.local/config.schema.json",
  "title": "SteelClock Configuration",
  "description": "Configuration schema for SteelClock v2 - display manager for SteelSeries devices",
  "type": "object",
  "required": ["display", "widgets"],
  "properties": {
    "schema_version": {
      "type": "integer",
      "description": "Schema version (2 for this schema)",
      "const": 2
    },
    "config_name": {
      "type": "string",
      "description": "Display name shown in profile selection menu (defaults to filename if not set)"
    },
    "game_name": {
      "type": "string",
      "description": "Internal game name for GameSense registration",
      "default": "STEELCLOCK"
    },
    "game_display_name": {
      "type": "string",
      "description": "Display name shown in SteelSeries GG",
      "default": "SteelClock"
    },
    "refresh_rate_ms": {
      "type": "integer",
      "description": "Display refresh rate in milliseconds. GameSense: min 100ms (10Hz). Direct: min 30ms (33Hz).",
      "minimum": 30,
      "default": 100
    },
    "unregister_on_exit": {
      "type": "boolean",
      "description": "Unregister from GameSense API on exit (may cause timeout)",
      "default": false
    },
    "deinitialize_timer_ms": {
      "type": "integer",
      "description": "Timeout for game deactivation after last event (1000-60000ms)",
      "minimum": 1000,
      "maximum": 60000
    },
    "backend": {
      "type": "string",
      "description": "Backend: 'gamesense' (requires SteelSeries GG), 'direct' (USB HID), 'webclient' (web browser display). If omitted, auto-selects (tries gamesense first, then direct)",
      "enum": ["gamesense", "direct", "webclient", ""]
    },
    "direct_driver": {
      "type": "object",
      "description": "Direct USB HID driver configuration",
      "properties": {
        "vid": {
          "type": "string",
          "description": "USB Vendor ID in hex (e.g., '1038'). Auto-detect if omitted.",
          "pattern": "^[0-9A-Fa-f]{1,4}$"
        },
        "pid": {
          "type": "string",
          "description": "USB Product ID in hex (e.g., '1612'). Auto-detect if omitted.",
          "pattern": "^[0-9A-Fa-f]{1,4}$"
        },
        "interface": {
          "type": "string",
          "description": "USB interface identifier",
          "default": "mi_01"
        }
      }
    },
    "webclient": {
      "type": "object",
      "description": "Web client backend configuration (only used when backend is 'webclient')",
      "properties": {
        "target_fps": {
          "type": "integer",
          "description": "Target frame rate for streaming to web browser (frames per second)",
          "minimum": 1,
          "maximum": 60,
          "default": 30
        }
      }
    },
    "bundled_font_url": {
      "type": ["string", "null"],
      "description": "Custom URL for downloading bundled font (null = use default)",
      "default": null
    },
    "display": {
      "type": "object",
      "description": "Physical display configuration",
      "required": ["width", "height"],
      "properties": {
        "width": {
          "type": "integer",
          "description": "Display width in pixels",
          "default": 128
        },
        "height": {
          "type": "integer",
          "description": "Display height in pixels",
          "default": 40
        },
        "background": {
          "type": "integer",
          "description": "Display background color (0=black, 255=white)",
          "minimum": 0,
          "maximum": 255,
          "default": 0
        }
      }
    },
    "defaults": {
      "type": "object",
      "description": "Default values inherited by all widgets",
      "properties": {
        "colors": {
          "type": "object",
          "description": "Named colors that widgets can reference with @name syntax",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0,
            "maximum": 255
          }
        },
        "text": { "$ref": "#/definitions/textObject" },
        "update_interval": {
          "type": "number",
          "description": "Default update interval in seconds",
          "minimum": 0.01,
          "default": 1.0
        }
      }
    },
    "widgets": {
      "type": "array",
      "description": "Array of widget configurations",
      "items": { "$ref": "#/definitions/widget" }
    }
  },
  "definitions": {
    "position": {
      "type": "object",
      "description": "Widget location and dimensions on the display",
      "required": ["x", "y", "w", "h"],
      "properties": {
        "x": { "type": "integer", "description": "Horizontal offset from left edge in pixels", "minimum": 0 },
        "y": { "type": "integer", "description": "Vertical offset from top edge in pixels" },
        "w": { "type": "integer", "description": "Widget width in pixels", "minimum": 1 },
        "h": { "type": "integer", "description": "Widget height in pixels", "minimum": 1 },
        "z": { "type": "integer", "description": "Layer order (higher values render on top)", "default": 0 }
      }
    },
    "style": {
      "type": "object",
      "description": "Widget visual appearance",
      "properties": {
        "background": {
          "type": "integer",
          "description": "Fill density (-1=none, 0=black, 255=white)",
          "minimum": -1,
          "maximum": 255,
          "default": 0
        },
        "border": {
          "type": "integer",
          "description": "Border density (-1=none, 0=black, 255=white)",
          "minimum": -1,
          "maximum": 255,
          "default": -1
        },
        "padding": {
          "type": "integer",
          "description": "Inner padding from edges in pixels",
          "minimum": 0,
          "default": 0
        }
      }
    },
    "textStyle": {
      "type": "object",
      "description": "Text styling properties (font, size, alignment)",
      "properties": {
        "font": { "type": ["string", "null"], "description": "Font name (pixel3x5, pixel5x7) or TTF path. Null = bundled font", "default": null },
        "size": { "type": "integer", "description": "Font size in pixels", "minimum": 1, "default": 10 },
        "align": {
          "type": "object",
          "description": "Text alignment within the widget content area",
          "properties": {
            "h": { "type": "string", "description": "Horizontal alignment", "enum": ["left", "center", "right"], "default": "center" },
            "v": { "type": "string", "description": "Vertical alignment", "enum": ["top", "center", "bottom"], "default": "center" }
          }
        }
      }
    },
    "textObject": {
      "type": "object",
      "description": "Text rendering properties with format string",
      "allOf": [
        { "$ref": "#/definitions/textStyle" },
        {
          "properties": {
            "format": { "type": "string", "description": "Format string (widget-specific)" }
          }
        }
      ]
    },
    "autoHide": {
      "type": "object",
      "description": "Auto-hide behavior",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable auto-hide", "default": false },
        "timeout": { "type": "number", "description": "Seconds before hiding", "minimum": 0.1, "default": 2.0 },
        "on_silence": { "type": "boolean", "description": "Hide on audio silence (audio widgets)", "default": false },
        "silence_time": { "type": "number", "description": "Silence duration before hiding", "minimum": 0.1, "default": 2.0 }
      }
    },
    "scrollConfig": {
      "type": "object",
      "description": "Text scrolling settings",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable text scrolling", "default": true },
        "direction": { "type": "string", "enum": ["left", "right", "up", "down"], "description": "Scroll direction", "default": "left" },
        "speed": { "type": "number", "description": "Scroll speed in pixels per second", "minimum": 1, "default": 30 },
        "mode": { "type": "string", "enum": ["continuous", "bounce", "pause_ends"], "description": "Scroll mode", "default": "continuous" },
        "gap": { "type": "integer", "description": "Gap in pixels between text repetitions (continuous mode)", "minimum": 0, "default": 20 }
      }
    },
    "separatorConfig": {
      "type": "object",
      "description": "Separator line between elements",
      "properties": {
        "color": { "type": "integer", "description": "Separator density (-1 = none, 0-255 = grayscale)", "minimum": -1, "maximum": 255, "default": 128 },
        "thickness": { "type": "integer", "description": "Separator thickness in pixels (0 = disabled)", "minimum": 0, "default": 1 }
      }
    },
    "transitionConfig": {
      "type": "object",
      "description": "Transition effects for showing/hiding",
      "properties": {
        "in": { "type": "string", "enum": ["none", "push_left", "push_right", "push_up", "push_down", "slide_left", "slide_right", "slide_up", "slide_down", "dissolve_fade", "dissolve_pixel", "dissolve_dither", "box_in", "box_out", "clock_wipe", "random"], "description": "Transition effect when showing", "default": "none" },
        "in_speed": { "type": "number", "description": "Transition in duration in seconds", "minimum": 0.1, "maximum": 5.0, "default": 0.5 },
        "out": { "type": "string", "enum": ["none", "push_left", "push_right", "push_up", "push_down", "slide_left", "slide_right", "slide_up", "slide_down", "dissolve_fade", "dissolve_pixel", "dissolve_dither", "box_in", "box_out", "clock_wipe", "random"], "description": "Transition effect when hiding", "default": "none" },
        "out_speed": { "type": "number", "description": "Transition out duration in seconds", "minimum": 0.1, "maximum": 5.0, "default": 0.5 }
      }
    },
    "telegramElementConfig": {
      "type": "object",
      "description": "Telegram notification element (header or message)",
      "properties": {
        "enabled": { "type": "boolean", "description": "Show this element", "default": true },
        "blink": { "type": "boolean", "description": "Make element blink", "default": false },
        "text": { "$ref": "#/definitions/textObject" },
        "scroll": { "$ref": "#/definitions/scrollConfig" },
        "word_break": { "type": "string", "enum": ["normal", "break-all"], "description": "How to break lines: normal (break on spaces) or break-all (break anywhere)", "default": "normal" }
      }
    },
    "telegramAppearanceConfig": {
      "type": "object",
      "description": "Appearance settings for telegram notifications",
      "properties": {
        "header": { "$ref": "#/definitions/telegramElementConfig" },
        "message": { "$ref": "#/definitions/telegramElementConfig" },
        "separator": { "$ref": "#/definitions/separatorConfig" },
        "timeout": { "type": "integer", "description": "Seconds to show notification (0 = until next message)", "minimum": 0, "default": 0 },
        "transitions": { "$ref": "#/definitions/transitionConfig" }
      }
    },
    "telegramChatFilterConfig": {
      "type": "object",
      "description": "Filter settings for a chat type (private/group/channel)",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable messages from this chat type (default: true for private, false for groups/channels)" },
        "whitelist": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Always include these chat IDs, even if this chat type is disabled"
        },
        "blacklist": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Never include these chat IDs, even if this chat type is enabled"
        },
        "pinned_messages": { "type": "boolean", "description": "Include pinned message notifications (default: true)" }
      }
    },
    "widget": {
      "type": "object",
      "required": ["type", "position"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Widget type to display",
          "enum": ["clipboard", "clock", "cpu", "memory", "network", "disk", "keyboard", "keyboard_layout", "volume", "volume_meter", "audio_visualizer", "doom", "winamp", "matrix", "weather", "battery", "game_of_life", "hyperspace", "starwars_intro", "telegram", "telegram_counter", "screen_mirror", "hacker_code"]
        },
        "enabled": { "type": "boolean", "description": "Show or hide this widget", "default": true },
        "position": { "$ref": "#/definitions/position" },
        "style": { "$ref": "#/definitions/style" },
        "update_interval": { "type": "number", "description": "Update interval in seconds", "minimum": 0.01 }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "clipboard" } }, "required": ["type"] },
          "then": {
            "properties": {
              "auto_hide": { "$ref": "#/definitions/autoHide" },
              "text": {
                "allOf": [
                  { "$ref": "#/definitions/textObject" },
                  {
                    "properties": {
                      "format": {
                        "description": "Format string with tokens: {content} (clipboard content or type description), {type} (content type label: Text/Image/Files/HTML/Empty/Unknown), {length} (content length), {preview} (first 20 chars of text)",
                        "default": "{content}"
                      }
                    }
                  }
                ]
              },
              "scroll": { "$ref": "#/definitions/scrollConfig" },
              "clipboard": {
                "type": "object",
                "description": "Clipboard widget settings",
                "properties": {
                  "max_length": {
                    "type": "integer",
                    "description": "Maximum characters to display (longer content is truncated)",
                    "minimum": 10,
                    "maximum": 1000,
                    "default": 100
                  },
                  "show_type": {
                    "type": "boolean",
                    "description": "Show content type prefix in format",
                    "default": true
                  },
                  "scroll_long_text": {
                    "type": "boolean",
                    "description": "Enable horizontal scrolling for long text",
                    "default": true
                  },
                  "poll_interval_ms": {
                    "type": "integer",
                    "description": "Clipboard check interval in milliseconds",
                    "minimum": 100,
                    "maximum": 5000,
                    "default": 500
                  },
                  "show_invisible": {
                    "type": "boolean",
                    "description": "Show invisible characters as escape sequences: newline as \\n, tab as \\t, carriage return as \\r",
                    "default": false
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "screen_mirror" } }, "required": ["type"] },
          "then": {
            "properties": {
              "screen_mirror": {
                "type": "object",
                "description": "Screen mirror widget settings",
                "properties": {
                  "display": {
                    "oneOf": [
                      { "type": "null" },
                      { "type": "integer", "minimum": -1 },
                      { "type": "string", "minLength": 1 }
                    ],
                    "description": "Display to capture: null = primary (default), 0-N = monitor by index, -1 = all monitors, string = match by name",
                    "default": null
                  },
                  "region": {
                    "type": ["object", "null"],
                    "description": "Rectangular region to capture (null = full display)",
                    "properties": {
                      "x": { "type": "integer", "description": "Left edge in screen coordinates" },
                      "y": { "type": "integer", "description": "Top edge in screen coordinates" },
                      "width": { "type": "integer", "description": "Region width in pixels", "minimum": 1 },
                      "height": { "type": "integer", "description": "Region height in pixels", "minimum": 1 }
                    },
                    "required": ["x", "y", "width", "height"]
                  },
                  "window": {
                    "type": ["object", "null"],
                    "description": "Window to capture (null = capture display/region)",
                    "properties": {
                      "title": { "type": "string", "description": "Substring to match in window title" },
                      "class": { "type": "string", "description": "Window class name to match (Windows-specific)" },
                      "active": { "type": "boolean", "description": "Capture the currently active/focused window", "default": false }
                    }
                  },
                  "scale_mode": {
                    "type": "string",
                    "description": "How to scale captured content to fit widget",
                    "enum": ["fit", "stretch", "crop"],
                    "default": "fit"
                  },
                  "fps": {
                    "type": "integer",
                    "description": "Capture framerate (frames per second)",
                    "minimum": 1,
                    "maximum": 30,
                    "default": 15
                  },
                  "dither_mode": {
                    "type": "string",
                    "description": "Dithering algorithm for monochrome conversion",
                    "enum": ["floyd_steinberg", "ordered", "none"],
                    "default": "floyd_steinberg"
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "clock" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textObject" },
              "mode": { "type": "string", "description": "Display mode: text, analog clock face, binary clock, or seven-segment display", "enum": ["text", "analog", "binary", "segment"], "default": "text" },
              "analog": {
                "type": "object",
                "description": "Analog clock face settings",
                "properties": {
                  "show_seconds": { "type": "boolean", "description": "Show seconds hand", "default": true },
                  "show_ticks": { "type": "boolean", "description": "Show hour tick marks", "default": true },
                  "colors": {
                    "type": "object",
                    "description": "Analog clock density values (-1 = none)",
                    "properties": {
                      "face": { "type": "integer", "description": "Clock face outline density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "hour": { "type": "integer", "description": "Hour hand density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "minute": { "type": "integer", "description": "Minute hand density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "second": { "type": "integer", "description": "Second hand density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "description": "Hour tick marks density", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              },
              "binary": {
                "type": "object",
                "description": "Binary clock settings",
                "properties": {
                  "format": { "type": "string", "description": "Time format: %H (hours), %M (minutes), %S (seconds)", "default": "%H:%M:%S" },
                  "style": { "type": "string", "description": "Binary style: BCD (per-digit 4-bit) or true binary (whole number)", "enum": ["bcd", "true"], "default": "bcd" },
                  "layout": { "type": "string", "description": "Layout: vertical (bits top-to-bottom) or horizontal (bits left-to-right)", "enum": ["vertical", "horizontal"], "default": "vertical" },
                  "show_labels": { "type": "boolean", "description": "Show H:M:S labels", "default": false },
                  "show_hint": { "type": "boolean", "description": "Show decimal values alongside binary", "default": false },
                  "dot_size": { "type": "integer", "description": "Dot diameter in pixels", "minimum": 1, "default": 4 },
                  "dot_spacing": { "type": "integer", "description": "Gap between dots in pixels", "minimum": 0, "default": 2 },
                  "dot_style": { "type": "string", "description": "Dot shape", "enum": ["circle", "square"], "default": "circle" },
                  "on_color": { "type": "integer", "description": "Density for 'on' bits (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                  "off_color": { "type": "integer", "description": "Density for 'off' bits (-1 = none)", "minimum": -1, "maximum": 255, "default": 40 }
                }
              },
              "segment": {
                "type": "object",
                "description": "Seven-segment display settings",
                "properties": {
                  "format": { "type": "string", "description": "Time format: %H (hours), %M (minutes), %S (seconds)", "default": "%H:%M:%S" },
                  "digit_height": { "type": "integer", "description": "Digit height in pixels (0 = auto-fit)", "minimum": 0, "default": 0 },
                  "segment_thickness": { "type": "integer", "description": "Segment line thickness in pixels", "minimum": 1, "default": 2 },
                  "segment_style": { "type": "string", "description": "Segment shape style", "enum": ["rectangle", "hexagon", "rounded"], "default": "rectangle" },
                  "digit_spacing": { "type": "integer", "description": "Space between digits in pixels", "minimum": 0, "default": 2 },
                  "colon_style": { "type": "string", "description": "Colon separator style", "enum": ["dots", "bar", "none"], "default": "dots" },
                  "colon_blink": { "type": "boolean", "description": "Blink colon separators", "default": true },
                  "on_color": { "type": "integer", "description": "Density for active segments (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                  "off_color": { "type": "integer", "description": "Density for inactive segments (-1 = none)", "minimum": -1, "maximum": 255, "default": 30 },
                  "flip": {
                    "type": "object",
                    "description": "Digit flip animation settings",
                    "properties": {
                      "style": { "type": "string", "description": "Animation style: none (disabled), fade (crossfade)", "enum": ["none", "fade"], "default": "none" },
                      "speed": { "type": "number", "description": "Animation duration in seconds", "minimum": 0.05, "maximum": 1.0, "default": 0.15 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "cpu" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textObject" },
              "mode": { "type": "string", "description": "Display mode for CPU usage", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "description": "Bar colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Bar fill color", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "description": "Graph mode settings",
                "properties": {
                  "history": { "type": "integer", "description": "Number of data points to display", "minimum": 2, "default": 60 },
                  "colors": {
                    "type": "object",
                    "description": "Graph colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Graph fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "line": { "type": "integer", "description": "Graph line density", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings",
                "properties": {
                  "show_ticks": { "type": "boolean", "description": "Show gauge tick marks", "default": true },
                  "colors": {
                    "type": "object",
                    "description": "Gauge colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Gauge fill color", "minimum": 0, "maximum": 255, "default": 255 },
                      "arc": { "type": "integer", "description": "Gauge arc outline color", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "description": "Gauge needle color", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "description": "Gauge tick marks color", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              },
              "per_core": {
                "type": "object",
                "description": "Per-core display settings",
                "properties": {
                  "enabled": { "type": "boolean", "description": "Show individual CPU cores", "default": false },
                  "margin": { "type": "integer", "description": "Margin between core bars in pixels", "minimum": 0, "default": 0 },
                  "border": { "type": "boolean", "description": "Draw border around each core bar", "default": false }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "memory" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textObject" },
              "mode": { "type": "string", "description": "Display mode for memory usage", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bar", "default": false },
                  "colors": {
                    "type": "object",
                    "description": "Bar colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Bar fill color", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "description": "Graph mode settings",
                "properties": {
                  "history": { "type": "integer", "description": "Number of data points to display", "minimum": 2, "default": 60 },
                  "colors": {
                    "type": "object",
                    "description": "Graph colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Graph fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "line": { "type": "integer", "description": "Graph line density", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings",
                "properties": {
                  "show_ticks": { "type": "boolean", "description": "Show gauge tick marks", "default": true },
                  "colors": {
                    "type": "object",
                    "description": "Gauge colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Gauge fill color", "minimum": 0, "maximum": 255, "default": 255 },
                      "arc": { "type": "integer", "description": "Gauge arc outline color", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "description": "Gauge needle color", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "description": "Gauge tick marks color", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "network" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "description": "Display mode for network I/O", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "interface": { "type": ["string", "null"], "description": "Network interface name (sum all interfaces if omitted)", "default": null },
              "max_speed_mbps": { "type": "number", "description": "Maximum speed in Mbps for scaling", "default": 100 },
              "unit": { "type": "string", "description": "Speed unit for display", "enum": ["auto", "bps", "Kbps", "Mbps", "Gbps", "B/s", "KB/s", "MB/s", "GB/s", "KiB/s", "MiB/s", "GiB/s"], "default": "Mbps" },
              "text": {
                "type": "object",
                "description": "Text mode settings",
                "allOf": [
                  { "$ref": "#/definitions/textStyle" },
                  {
                    "properties": {
                      "show_unit": { "type": "boolean", "description": "Show unit suffix (e.g., 'Mbps') in text mode", "default": false }
                    }
                  }
                ]
              },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "description": "Bar density values for RX/TX (-1 = none)",
                    "properties": {
                      "rx": { "type": "integer", "description": "Receive (download) bar density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "description": "Transmit (upload) bar density (-1 = none)", "minimum": -1, "maximum": 255, "default": 128 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "description": "Graph mode settings",
                "properties": {
                  "history": { "type": "integer", "description": "Number of data points to display", "minimum": 2, "default": 60 },
                  "colors": {
                    "type": "object",
                    "description": "Graph density values for RX/TX (-1 = none)",
                    "properties": {
                      "rx": { "type": "integer", "description": "Receive (download) fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "description": "Transmit (upload) fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 128 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings (dual gauge: outer for RX, inner for TX)",
                "properties": {
                  "colors": {
                    "type": "object",
                    "description": "Gauge density values for RX/TX (-1 = none)",
                    "properties": {
                      "rx": { "type": "integer", "description": "Receive (download) arc density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "description": "Transmit (upload) arc density (-1 = none)", "minimum": -1, "maximum": 255, "default": 128 },
                      "rx_needle": { "type": "integer", "description": "Receive needle density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "tx_needle": { "type": "integer", "description": "Transmit needle density (-1 = none)", "minimum": -1, "maximum": 255, "default": 180 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "disk" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "description": "Display mode for disk I/O", "enum": ["text", "bar", "graph"], "default": "bar" },
              "disk": { "type": ["string", "null"], "description": "Disk/drive to monitor (sum all disks if omitted)" },
              "max_speed_mbps": { "type": "number", "description": "Maximum speed in MB/s for scaling (-1 for auto)", "default": -1 },
              "unit": { "type": "string", "description": "Speed unit for display", "enum": ["auto", "B/s", "KB/s", "MB/s", "GB/s", "KiB/s", "MiB/s", "GiB/s"], "default": "MB/s" },
              "text": {
                "type": "object",
                "description": "Text mode settings",
                "allOf": [
                  { "$ref": "#/definitions/textStyle" },
                  {
                    "properties": {
                      "show_unit": { "type": "boolean", "description": "Show unit suffix (e.g., 'MB/s') in text mode", "default": false }
                    }
                  }
                ]
              },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "description": "Bar density values for read/write (-1 = none)",
                    "properties": {
                      "read": { "type": "integer", "description": "Read bar density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "write": { "type": "integer", "description": "Write bar density (-1 = none)", "minimum": -1, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "description": "Graph mode settings",
                "properties": {
                  "history": { "type": "integer", "description": "Number of data points to display", "minimum": 2, "default": 60 },
                  "colors": {
                    "type": "object",
                    "description": "Graph density values for read/write (-1 = none)",
                    "properties": {
                      "read": { "type": "integer", "description": "Read fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "write": { "type": "integer", "description": "Write fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 200 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "volume" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textObject" },
              "auto_hide": { "$ref": "#/definitions/autoHide" },
              "poll_interval": { "type": "number", "description": "Internal polling interval in seconds", "minimum": 0.01, "default": 0.1 },
              "mode": { "type": "string", "description": "Display mode for system volume", "enum": ["text", "bar", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bar", "default": false },
                  "colors": {
                    "type": "object",
                    "description": "Bar colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Bar fill color", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings",
                "properties": {
                  "show_ticks": { "type": "boolean", "description": "Show gauge tick marks", "default": true },
                  "colors": {
                    "type": "object",
                    "description": "Gauge colors",
                    "properties": {
                      "arc": { "type": "integer", "description": "Gauge arc outline color", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "description": "Gauge needle color", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "description": "Gauge tick marks color", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "volume_meter" } }, "required": ["type"] },
          "then": {
            "properties": {
              "auto_hide": { "$ref": "#/definitions/autoHide" },
              "poll_interval": { "type": "number", "description": "Internal polling interval in seconds", "minimum": 0.01, "default": 0.1 },
              "mode": { "type": "string", "description": "Display mode for audio peak meter", "enum": ["text", "bar", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "description": "Bar mode settings",
                "properties": {
                  "direction": { "type": "string", "description": "Bar orientation", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "colors": {
                    "type": "object",
                    "description": "Bar colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Bar fill color", "minimum": 0, "maximum": 255, "default": 255 },
                      "clipping": { "type": "integer", "description": "Clipping indicator color", "minimum": 0, "maximum": 255, "default": 200 },
                      "peak": { "type": "integer", "description": "Peak hold indicator color", "minimum": 0, "maximum": 255, "default": 180 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings",
                "properties": {
                  "show_ticks": { "type": "boolean", "description": "Show gauge tick marks", "default": true },
                  "colors": {
                    "type": "object",
                    "description": "Gauge colors",
                    "properties": {
                      "arc": { "type": "integer", "description": "Gauge arc outline color", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "description": "Gauge needle color", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "description": "Gauge tick marks color", "minimum": 0, "maximum": 255, "default": 150 },
                      "clipping": { "type": "integer", "description": "Clipping needle color", "minimum": 0, "maximum": 255, "default": 200 },
                      "peak": { "type": "integer", "description": "Peak hold indicator color", "minimum": 0, "maximum": 255, "default": 180 }
                    }
                  }
                }
              },
              "text": {
                "allOf": [
                  { "$ref": "#/definitions/textObject" },
                  {
                    "properties": {
                      "format": { "description": "Text format string (e.g., '%d%%')", "default": "%d%%" }
                    }
                  }
                ]
              },
              "stereo": {
                "type": "object",
                "description": "Stereo channel settings",
                "properties": {
                  "enabled": { "type": "boolean", "description": "Show separate left/right channels", "default": false },
                  "divider": { "type": "integer", "description": "Divider line density between left/right channels (-1 = none, 0-255 = grayscale)", "minimum": -1, "maximum": 255, "default": 64 }
                }
              },
              "metering": {
                "type": "object",
                "description": "Audio metering settings",
                "properties": {
                  "db_scale": { "type": "boolean", "description": "Use logarithmic dB scale instead of linear", "default": false },
                  "decay_rate": { "type": "number", "description": "Peak decay rate in dB/second", "minimum": 0.1, "default": 2.0 },
                  "silence_threshold": { "type": "number", "description": "Threshold below which audio is considered silent", "minimum": 0, "maximum": 1, "default": 0.01 }
                }
              },
              "peak": {
                "type": "object",
                "description": "Peak hold indicator settings",
                "properties": {
                  "enabled": { "type": "boolean", "description": "Show peak hold indicators", "default": true },
                  "hold_time": { "type": "number", "description": "Peak hold duration in seconds", "minimum": 0.1, "default": 1.0 }
                }
              },
              "clipping": {
                "type": "object",
                "description": "Clipping detection settings",
                "properties": {
                  "enabled": { "type": "boolean", "description": "Enable clipping detection", "default": true },
                  "threshold": { "type": "number", "description": "Clipping threshold (0.0-1.0)", "minimum": 0, "maximum": 1, "default": 0.99 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "audio_visualizer" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "description": "Display mode: spectrum analyzer or oscilloscope", "enum": ["spectrum", "oscilloscope"], "default": "spectrum" },
              "spectrum": {
                "type": "object",
                "description": "Spectrum analyzer settings",
                "properties": {
                  "bars": { "type": "integer", "description": "Number of frequency bars", "minimum": 8, "maximum": 128, "default": 32 },
                  "scale": { "type": "string", "description": "Frequency scale distribution", "enum": ["logarithmic", "linear"], "default": "logarithmic" },
                  "style": { "type": "string", "description": "Rendering style", "enum": ["bars", "line"], "default": "bars" },
                  "smoothing": { "type": "number", "description": "Fall-off smoothing factor (0=instant, 1=max smooth)", "minimum": 0, "maximum": 1, "default": 0.7 },
                  "frequency_compensation": { "type": "boolean", "description": "Boost high frequencies for visual balance", "default": false },
                  "dynamic_scaling": {
                    "type": "object",
                    "description": "Automatic amplitude scaling",
                    "properties": {
                      "strength": { "type": "number", "description": "Scaling strength (0=disabled)", "minimum": 0, "maximum": 2, "default": 0 },
                      "window": { "type": "number", "description": "Rolling average window in seconds", "minimum": 0.1, "maximum": 5, "default": 0.5 }
                    }
                  },
                  "peak": {
                    "type": "object",
                    "description": "Peak hold indicator settings",
                    "properties": {
                      "enabled": { "type": "boolean", "description": "Show peak hold indicators on bars", "default": true },
                      "hold_time": { "type": "number", "description": "Peak hold duration in seconds", "minimum": 0.1, "default": 1.0 }
                    }
                  },
                  "colors": {
                    "type": "object",
                    "description": "Spectrum colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Bar/line fill color", "minimum": 0, "maximum": 255, "default": 255 },
                      "left": { "type": "integer", "description": "Left channel color (stereo_separated)", "minimum": 0, "maximum": 255, "default": 255 },
                      "right": { "type": "integer", "description": "Right channel color (stereo_separated)", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "oscilloscope": {
                "type": "object",
                "description": "Oscilloscope settings",
                "properties": {
                  "style": { "type": "string", "description": "Waveform rendering style", "enum": ["line", "filled"], "default": "line" },
                  "samples": { "type": "integer", "description": "Number of samples to display", "minimum": 32, "maximum": 512, "default": 128 },
                  "colors": {
                    "type": "object",
                    "description": "Oscilloscope colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Waveform color", "minimum": 0, "maximum": 255, "default": 255 },
                      "left": { "type": "integer", "description": "Left channel color (stereo_separated)", "minimum": 0, "maximum": 255, "default": 255 },
                      "right": { "type": "integer", "description": "Right channel color (stereo_separated)", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "channel": { "type": "string", "description": "Audio channel mode", "enum": ["mono", "stereo_combined", "stereo_separated"], "default": "stereo_combined" },
              "error_threshold": { "type": "integer", "description": "Consecutive errors before audio failure (default: 30, ~3 seconds)", "minimum": 1, "default": 30 }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "keyboard" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textStyle" },
              "indicators": {
                "type": "object",
                "description": "Keyboard lock indicator settings",
                "properties": {
                  "caps": {
                    "type": "object",
                    "description": "Caps Lock indicator",
                    "properties": {
                      "on": { "type": ["string", "null"], "description": "Text when Caps Lock is on (null = embedded glyph)", "default": null },
                      "off": { "type": ["string", "null"], "description": "Text when Caps Lock is off (null = embedded glyph)", "default": null }
                    }
                  },
                  "num": {
                    "type": "object",
                    "description": "Num Lock indicator",
                    "properties": {
                      "on": { "type": ["string", "null"], "description": "Text when Num Lock is on (null = embedded glyph)", "default": null },
                      "off": { "type": ["string", "null"], "description": "Text when Num Lock is off (null = embedded glyph)", "default": null }
                    }
                  },
                  "scroll": {
                    "type": "object",
                    "description": "Scroll Lock indicator",
                    "properties": {
                      "on": { "type": ["string", "null"], "description": "Text when Scroll Lock is on (null = embedded glyph)", "default": null },
                      "off": { "type": ["string", "null"], "description": "Text when Scroll Lock is off (null = embedded glyph)", "default": null }
                    }
                  }
                }
              },
              "layout": {
                "type": "object",
                "description": "Indicator layout settings",
                "properties": {
                  "spacing": { "type": "integer", "description": "Spacing between indicators in pixels", "minimum": 0, "default": 3 },
                  "separator": { "type": "string", "description": "Separator character between indicators", "default": "" }
                }
              },
              "colors": {
                "type": "object",
                "description": "Indicator density values (-1 = none)",
                "properties": {
                  "on": { "type": "integer", "description": "Density when indicator is active (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                  "off": { "type": "integer", "description": "Density when indicator is inactive (-1 = none)", "minimum": -1, "maximum": 255, "default": 100 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "keyboard_layout" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textStyle" },
              "format": { "type": "string", "description": "Language code format: iso639-1 (EN), iso639-2 (ENG), or full (English)", "enum": ["iso639-1", "iso639-2", "full"], "default": "iso639-1" }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "doom" } }, "required": ["type"] },
          "then": {
            "properties": {
              "wad": { "type": "string", "description": "WAD file name (auto-downloads doom1.wad if not found)", "default": "doom1.wad" },
              "bundled_wad_url": { "type": ["string", "null"], "description": "Custom URL for downloading DOOM shareware WAD (null = use default distro.ibiblio.org)", "default": null },
              "doom": {
                "type": "object",
                "description": "DOOM display rendering settings",
                "properties": {
                  "render_mode": {
                    "type": "string",
                    "description": "Grayscale conversion mode for OLED display",
                    "enum": ["normal", "contrast", "posterize", "threshold", "dither", "gamma"],
                    "default": "normal"
                  },
                  "posterize_levels": {
                    "type": "integer",
                    "description": "Number of gray levels for posterize mode (2-16)",
                    "minimum": 2,
                    "maximum": 16,
                    "default": 4
                  },
                  "threshold_value": {
                    "type": "integer",
                    "description": "Cutoff value for threshold mode (0-255)",
                    "minimum": 0,
                    "maximum": 255,
                    "default": 128
                  },
                  "gamma": {
                    "type": "number",
                    "description": "Gamma value for gamma mode (0.1-3.0, >1 brightens midtones)",
                    "minimum": 0.1,
                    "maximum": 3.0,
                    "default": 1.5
                  },
                  "contrast_boost": {
                    "type": "number",
                    "description": "Contrast multiplier for gamma mode (1.0-3.0)",
                    "minimum": 1.0,
                    "maximum": 3.0,
                    "default": 1.2
                  },
                  "dither_size": {
                    "type": "integer",
                    "description": "Bayer matrix size for dither mode (2, 4, or 8)",
                    "enum": [2, 4, 8],
                    "default": 4
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "winamp" } }, "required": ["type"] },
          "then": {
            "properties": {
              "auto_hide": { "$ref": "#/definitions/autoHide" },
              "text": {
                "allOf": [
                  { "$ref": "#/definitions/textObject" },
                  {
                    "properties": {
                      "format": {
                        "description": "Format string with placeholders: {title} (track title), {filename} (file name), {filepath} (full path), {position} (MM:SS), {duration} (MM:SS), {position_ms} (ms), {duration_s} (seconds), {bitrate} (kbps), {samplerate} (Hz), {channels} (count), {status} (Playing/Paused/Stopped), {track_num} (current track number in playlist), {playlist_length} (total tracks in playlist), {shuffle} ('S' if enabled, empty otherwise), {repeat} ('R' if enabled, empty otherwise), {version} (Winamp version string)",
                        "default": "{title}"
                      }
                    }
                  }
                ]
              },
              "winamp": {
                "type": "object",
                "description": "Winamp-specific settings (placeholder when not playing)",
                "properties": {
                  "placeholder": {
                    "type": "object",
                    "description": "What to show when Winamp is not playing",
                    "properties": {
                      "mode": {
                        "type": "string",
                        "description": "Placeholder mode",
                        "enum": ["text", "icon"],
                        "default": "icon"
                      },
                      "text": {
                        "type": "string",
                        "description": "Text to display when mode is 'text'",
                        "default": "No Winamp"
                      }
                    }
                  }
                }
              },
              "auto_show": {
                "type": "object",
                "description": "Events that trigger the widget to appear (when auto_hide is enabled)",
                "properties": {
                  "on_track_change": {
                    "type": "boolean",
                    "description": "Show widget when track changes",
                    "default": true
                  },
                  "on_play": {
                    "type": "boolean",
                    "description": "Show widget when playback starts",
                    "default": false
                  },
                  "on_pause": {
                    "type": "boolean",
                    "description": "Show widget when playback is paused",
                    "default": false
                  },
                  "on_stop": {
                    "type": "boolean",
                    "description": "Show widget when playback stops",
                    "default": false
                  },
                  "on_seek": {
                    "type": "boolean",
                    "description": "Show widget when user seeks to different position",
                    "default": false
                  }
                }
              },
              "scroll": {
                "type": "object",
                "description": "Text scrolling settings",
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "description": "Enable text scrolling",
                    "default": false
                  },
                  "direction": {
                    "type": "string",
                    "description": "Scroll direction",
                    "enum": ["left", "right", "up", "down"],
                    "default": "left"
                  },
                  "speed": {
                    "type": "number",
                    "description": "Scroll speed in pixels per second",
                    "minimum": 1,
                    "default": 30
                  },
                  "mode": {
                    "type": "string",
                    "description": "Scroll mode: continuous (loop), bounce (reverse at edges), pause_ends (pause at start/end)",
                    "enum": ["continuous", "bounce", "pause_ends"],
                    "default": "continuous"
                  },
                  "pause_ms": {
                    "type": "integer",
                    "description": "Pause duration at ends in milliseconds (for bounce/pause_ends modes)",
                    "minimum": 0,
                    "default": 1000
                  },
                  "gap": {
                    "type": "integer",
                    "description": "Gap between text repetitions in pixels (for continuous mode)",
                    "minimum": 0,
                    "default": 20
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "matrix" } }, "required": ["type"] },
          "then": {
            "properties": {
              "matrix": {
                "type": "object",
                "description": "Matrix 'digital rain' effect settings",
                "properties": {
                  "charset": {
                    "type": "string",
                    "description": "Character set to use for the rain effect",
                    "enum": ["ascii", "katakana", "binary", "digits", "hex"],
                    "default": "ascii"
                  },
                  "density": {
                    "type": "number",
                    "description": "Column density (0.0-1.0) - probability of a column being active",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.4
                  },
                  "min_speed": {
                    "type": "number",
                    "description": "Minimum fall speed in pixels per frame",
                    "minimum": 0.1,
                    "default": 0.5
                  },
                  "max_speed": {
                    "type": "number",
                    "description": "Maximum fall speed in pixels per frame",
                    "minimum": 0.1,
                    "default": 2.0
                  },
                  "min_length": {
                    "type": "integer",
                    "description": "Minimum trail length in characters",
                    "minimum": 1,
                    "default": 4
                  },
                  "max_length": {
                    "type": "integer",
                    "description": "Maximum trail length in characters",
                    "minimum": 1,
                    "default": 15
                  },
                  "head_color": {
                    "type": "integer",
                    "description": "Brightness of the leading character (0-255)",
                    "minimum": 0,
                    "maximum": 255,
                    "default": 255
                  },
                  "trail_fade": {
                    "type": "number",
                    "description": "Trail fade factor (0.0-1.0) - how quickly characters fade",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.85
                  },
                  "char_change_rate": {
                    "type": "number",
                    "description": "Probability of a character changing per frame (0.0-1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.02
                  },
                  "font_size": {
                    "type": "string",
                    "description": "Font size: 'small' (3x5 pixels), 'large' (5x7 pixels), or 'auto' (based on display height)",
                    "enum": ["auto", "small", "large"],
                    "default": "auto"
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "weather" } }, "required": ["type"] },
          "then": {
            "properties": {
              "text": { "$ref": "#/definitions/textObject" },
              "weather": {
                "type": "object",
                "description": "Weather widget settings",
                "properties": {
                  "provider": {
                    "type": "string",
                    "description": "Weather data provider",
                    "enum": ["open-meteo", "openweathermap"],
                    "default": "open-meteo"
                  },
                  "api_key": {
                    "type": "string",
                    "description": "API key for OpenWeatherMap (required for openweathermap provider)"
                  },
                  "location": {
                    "type": "object",
                    "description": "Location for weather data",
                    "properties": {
                      "city": {
                        "type": "string",
                        "description": "City name (e.g., 'London' or 'New York,US'). Only supported with openweathermap provider."
                      },
                      "lat": {
                        "type": "number",
                        "description": "Latitude coordinate",
                        "minimum": -90,
                        "maximum": 90
                      },
                      "lon": {
                        "type": "number",
                        "description": "Longitude coordinate",
                        "minimum": -180,
                        "maximum": 180
                      }
                    }
                  },
                  "units": {
                    "type": "string",
                    "description": "Temperature units",
                    "enum": ["metric", "imperial"],
                    "default": "metric"
                  },
                  "icon_size": {
                    "type": "integer",
                    "description": "Weather icon size in pixels (16 or 24)",
                    "enum": [16, 24],
                    "default": 16
                  },
                  "format": {
                    "oneOf": [
                      { "type": "string" },
                      { "type": "array", "items": { "type": "string" } }
                    ],
                    "description": "Display format string(s) with tokens. Can be a single string or array of strings (for cycling). Available tokens: {icon} (weather icon), {temp} (temperature), {feels} (feels like temp), {humidity} (humidity %), {wind} (wind speed), {wind_dir} (wind direction), {pressure} (pressure), {visibility} (visibility), {condition} (weather condition text), {description} (detailed description), {aqi} (air quality index), {aqi_level} (AQI level text), {uv} (UV index), {uv_level} (UV level text), {forecast:graph} (temperature graph), {forecast:icons} (forecast day icons), {forecast:scroll} (scrolling forecast). Use \\n for multi-line layouts.",
                    "default": "{icon} {temp}"
                  },
                  "cycle": {
                    "type": "object",
                    "description": "Format cycling and transition settings",
                    "properties": {
                      "interval": {
                        "type": "integer",
                        "description": "Seconds between format changes (0 to disable cycling)",
                        "minimum": 0,
                        "default": 10
                      },
                      "transition": {
                        "type": "string",
                        "description": "Transition effect between formats",
                        "enum": ["none", "push_left", "push_right", "push_up", "push_down", "slide_left", "slide_right", "slide_up", "slide_down", "dissolve_fade", "dissolve_pixel", "dissolve_dither", "box_in", "box_out", "clock_wipe", "random"],
                        "default": "none"
                      },
                      "speed": {
                        "type": "number",
                        "description": "Transition duration in seconds",
                        "minimum": 0.1,
                        "maximum": 5.0,
                        "default": 0.5
                      }
                    }
                  },
                  "forecast": {
                    "type": "object",
                    "description": "Forecast display settings (auto-enabled when forecast tokens are used in format)",
                    "properties": {
                      "hours": {
                        "type": "integer",
                        "description": "Number of hours for hourly forecast",
                        "minimum": 6,
                        "maximum": 48,
                        "default": 24
                      },
                      "days": {
                        "type": "integer",
                        "description": "Number of days for daily forecast",
                        "minimum": 1,
                        "maximum": 7,
                        "default": 3
                      },
                      "scroll_speed": {
                        "type": "number",
                        "description": "Scroll speed in pixels per second for {forecast:scroll}",
                        "minimum": 1,
                        "maximum": 200,
                        "default": 30
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "battery" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": {
                "type": "string",
                "description": "Display mode: battery (progressbar in battery shape), text, bar, gauge, graph",
                "enum": ["battery", "text", "bar", "gauge", "graph"],
                "default": "battery"
              },
              "battery": {
                "type": "object",
                "description": "Battery widget settings.",
                "properties": {
                  "orientation": {
                    "type": "string",
                    "description": "Battery orientation",
                    "enum": ["horizontal", "vertical"],
                    "default": "horizontal"
                  },
                  "low_threshold": {
                    "type": "integer",
                    "description": "Percentage below which battery is considered low",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 20
                  },
                  "critical_threshold": {
                    "type": "integer",
                    "description": "Percentage below which battery is considered critical",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 10
                  },
                  "colors": {
                    "type": "object",
                    "description": "Color settings for battery display (0-255, 0=black supported)",
                    "properties": {
                      "normal": {
                        "type": "integer",
                        "description": "Fill color when battery is normal",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 255
                      },
                      "low": {
                        "type": "integer",
                        "description": "Fill color when battery is low",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 200
                      },
                      "critical": {
                        "type": "integer",
                        "description": "Fill color when battery is critical",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 150
                      },
                      "charging": {
                        "type": "integer",
                        "description": "Charging indicator color",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 255
                      },
                      "background": {
                        "type": "integer",
                        "description": "Background color inside battery body",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 0
                      },
                      "border": {
                        "type": "integer",
                        "description": "Battery outline color",
                        "minimum": 0,
                        "maximum": 255,
                        "default": 255
                      }
                    }
                  }
                }
              },
              "power_status": {
                "type": "object",
                "description": "Power status indicator display settings",
                "properties": {
                  "show_economy": {
                    "type": "string",
                    "description": "Display mode for economy/power saver indicator",
                    "enum": ["always", "never", "notify", "blink", "notify_blink"],
                    "default": "blink"
                  },
                  "show_charging": {
                    "type": "string",
                    "description": "Display mode for charging indicator",
                    "enum": ["always", "never", "notify", "blink", "notify_blink"],
                    "default": "always"
                  },
                  "show_plugged": {
                    "type": "string",
                    "description": "Display mode for AC power indicator",
                    "enum": ["always", "never", "notify", "blink", "notify_blink"],
                    "default": "always"
                  },
                  "notify_duration": {
                    "type": "integer",
                    "description": "Seconds to show indicator in notify modes",
                    "minimum": 1,
                    "default": 60
                  }
                }
              },
              "bar": {
                "type": "object",
                "description": "Bar mode settings (use direction: up/down for vertical orientation)",
                "properties": {
                  "direction": { "type": "string", "enum": ["left", "right", "up", "down"], "default": "left" },
                  "border": { "type": "boolean", "default": false }
                }
              },
              "graph": {
                "type": "object",
                "description": "Graph mode settings",
                "properties": {
                  "history": { "type": "integer", "minimum": 10, "maximum": 500, "default": 60 },
                  "colors": {
                    "type": "object",
                    "description": "Graph colors",
                    "properties": {
                      "fill": { "type": "integer", "description": "Graph fill density (-1 = none)", "minimum": -1, "maximum": 255, "default": 255 },
                      "line": { "type": "integer", "description": "Graph line density", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "description": "Gauge mode settings",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true }
                }
              },
              "text": {
                "allOf": [
                  { "$ref": "#/definitions/textObject" },
                  {
                    "properties": {
                      "format": {
                        "description": "Format string with tokens: {percent}/{pct} (value), {status} (CHG/AC/ECO), {status_full} (Charging/AC Power/Economy), {time} (smart remaining), {time_left}, {time_to_full}, {time_left_min} (minutes), {level} (critical/low/normal), {charging}/{plugged}/{economy} (boolean indicators)",
                        "default": "{percent}%"
                      },
                      "size": { "default": 16 }
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "game_of_life" } }, "required": ["type"] },
          "then": {
            "properties": {
              "game_of_life": {
                "type": "object",
                "description": "Conway's Game of Life cellular automaton settings",
                "properties": {
                  "rules": {
                    "type": "string",
                    "description": "Cellular automaton rules in B/S notation. B = birth neighbor counts, S = survival neighbor counts. Examples: 'B3/S23' (Conway), 'B36/S23' (HighLife), 'B1357/S1357' (Replicator)",
                    "default": "B3/S23"
                  },
                  "wrap_edges": {
                    "type": "boolean",
                    "description": "Wrap edges to form a torus topology (patterns wrap around)",
                    "default": true
                  },
                  "initial_pattern": {
                    "type": "string",
                    "description": "Starting pattern for the simulation",
                    "enum": ["random", "clear", "glider", "r_pentomino", "acorn", "diehard", "lwss", "pulsar", "glider_gun"],
                    "default": "random"
                  },
                  "random_density": {
                    "type": "number",
                    "description": "Probability of cell being alive in random pattern (0.0-1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.3
                  },
                  "cell_size": {
                    "type": "integer",
                    "description": "Pixels per cell (1-4). Larger = fewer cells but more visible",
                    "minimum": 1,
                    "maximum": 4,
                    "default": 1
                  },
                  "trail_effect": {
                    "type": "boolean",
                    "description": "Enable fading trail when cells die (grayscale ghost effect)",
                    "default": true
                  },
                  "trail_decay": {
                    "type": "integer",
                    "description": "Brightness decay per frame for dead cells (higher = faster fade)",
                    "minimum": 1,
                    "maximum": 255,
                    "default": 30
                  },
                  "cell_color": {
                    "type": "integer",
                    "description": "Brightness of alive cells (1-255)",
                    "minimum": 1,
                    "maximum": 255,
                    "default": 255
                  },
                  "restart_timeout": {
                    "type": "number",
                    "description": "Seconds to wait before restarting when simulation ends (all cells dead or pattern stable). 0 = restart immediately, -1 = never restart",
                    "minimum": -1,
                    "default": 3.0
                  },
                  "restart_mode": {
                    "type": "string",
                    "description": "How to restart: 'reset' = use initial_pattern, 'inject' = add random cells to existing grid (keeps survivors), 'random' = always use fresh random pattern",
                    "enum": ["reset", "inject", "random"],
                    "default": "reset"
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "hyperspace" } }, "required": ["type"] },
          "then": {
            "properties": {
              "hyperspace": {
                "type": "object",
                "description": "Star Wars hyperspace/lightspeed effect settings",
                "properties": {
                  "star_count": {
                    "type": "integer",
                    "description": "Number of stars in the field",
                    "minimum": 10,
                    "maximum": 500,
                    "default": 100
                  },
                  "speed": {
                    "type": "number",
                    "description": "Base star movement speed (idle/slow mode)",
                    "minimum": 0.001,
                    "maximum": 1.0,
                    "default": 0.02
                  },
                  "max_speed": {
                    "type": "number",
                    "description": "Maximum star speed during hyperspace jump",
                    "minimum": 0.01,
                    "maximum": 2.0,
                    "default": 0.5
                  },
                  "trail_length": {
                    "type": "number",
                    "description": "Star trail length multiplier (1.0 = normal)",
                    "minimum": 0.1,
                    "maximum": 5.0,
                    "default": 1.0
                  },
                  "center_x": {
                    "type": "integer",
                    "description": "Focal point X coordinate (null = widget center)"
                  },
                  "center_y": {
                    "type": "integer",
                    "description": "Focal point Y coordinate (null = widget center)"
                  },
                  "star_color": {
                    "type": "integer",
                    "description": "Maximum star brightness (0-255)",
                    "minimum": 1,
                    "maximum": 255,
                    "default": 255
                  },
                  "mode": {
                    "type": "string",
                    "description": "Animation mode: 'continuous' (always in hyperspace), 'cycle' (phases: idle -> jump -> travel -> exit)",
                    "enum": ["continuous", "cycle"],
                    "default": "continuous"
                  },
                  "idle_time": {
                    "type": "number",
                    "description": "Seconds in idle phase before jumping (cycle mode only)",
                    "minimum": 0.5,
                    "maximum": 60.0,
                    "default": 5.0
                  },
                  "travel_time": {
                    "type": "number",
                    "description": "Seconds spent in hyperspace (cycle mode only)",
                    "minimum": 0.5,
                    "maximum": 60.0,
                    "default": 3.0
                  },
                  "acceleration": {
                    "type": "number",
                    "description": "Speed change rate during jump/exit phases (cycle mode only)",
                    "minimum": 0.01,
                    "maximum": 1.0,
                    "default": 0.1
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "starwars_intro" } }, "required": ["type"] },
          "then": {
            "properties": {
              "starwars_intro": {
                "type": "object",
                "description": "Star Wars opening crawl with pre-intro text, shrinking logo, and perspective text crawl",
                "properties": {
                  "pre_intro": {
                    "type": "object",
                    "description": "Pre-intro phase settings ('A long time ago in a galaxy far, far away....')",
                    "properties": {
                      "enabled": {
                        "type": "boolean",
                        "description": "Show the pre-intro phase",
                        "default": true
                      },
                      "text": {
                        "type": "string",
                        "description": "The pre-intro message text (use \\n for line breaks)",
                        "default": "A long time ago in a galaxy far, far away...."
                      },
                      "color": {
                        "type": "integer",
                        "description": "Text brightness (1-255, bluish dim appearance)",
                        "minimum": 1,
                        "maximum": 255,
                        "default": 80
                      },
                      "fade_in": {
                        "type": "number",
                        "description": "Fade in duration in seconds",
                        "minimum": 0.0,
                        "maximum": 10.0,
                        "default": 2.0
                      },
                      "hold": {
                        "type": "number",
                        "description": "Hold duration in seconds after fade in",
                        "minimum": 0.0,
                        "maximum": 30.0,
                        "default": 2.0
                      },
                      "fade_out": {
                        "type": "number",
                        "description": "Fade out duration in seconds",
                        "minimum": 0.0,
                        "maximum": 10.0,
                        "default": 1.0
                      }
                    }
                  },
                  "logo": {
                    "type": "object",
                    "description": "Logo phase settings (shrinking 'STAR WARS' logo)",
                    "properties": {
                      "enabled": {
                        "type": "boolean",
                        "description": "Show the logo phase",
                        "default": true
                      },
                      "text": {
                        "type": "string",
                        "description": "Logo text (use \\n for line breaks)",
                        "default": "STAR\\nWARS"
                      },
                      "color": {
                        "type": "integer",
                        "description": "Logo brightness (1-255)",
                        "minimum": 1,
                        "maximum": 255,
                        "default": 255
                      },
                      "hold_before": {
                        "type": "number",
                        "description": "Seconds to hold at full size before shrinking",
                        "minimum": 0.0,
                        "maximum": 10.0,
                        "default": 0.5
                      },
                      "shrink_duration": {
                        "type": "number",
                        "description": "Seconds for the shrink animation",
                        "minimum": 0.5,
                        "maximum": 30.0,
                        "default": 4.0
                      },
                      "final_scale": {
                        "type": "number",
                        "description": "Scale at which logo disappears (0.0-1.0)",
                        "minimum": 0.0,
                        "maximum": 0.5,
                        "default": 0.1
                      },
                      "line_spacing": {
                        "type": "integer",
                        "description": "Pixels between logo text lines",
                        "minimum": 0,
                        "maximum": 20,
                        "default": 1
                      }
                    }
                  },
                  "stars": {
                    "type": "object",
                    "description": "Background starfield settings (visible during logo and crawl)",
                    "properties": {
                      "enabled": {
                        "type": "boolean",
                        "description": "Show background stars",
                        "default": true
                      },
                      "count": {
                        "type": "integer",
                        "description": "Number of stars",
                        "minimum": 10,
                        "maximum": 200,
                        "default": 50
                      },
                      "brightness": {
                        "type": "integer",
                        "description": "Maximum star brightness (1-255)",
                        "minimum": 1,
                        "maximum": 255,
                        "default": 200
                      }
                    }
                  },
                  "text": {
                    "type": "array",
                    "description": "Lines of text to display in the crawl",
                    "items": {
                      "type": "string"
                    }
                  },
                  "scroll_speed": {
                    "type": "number",
                    "description": "Scroll speed in pixels per frame",
                    "minimum": 0.1,
                    "maximum": 5.0,
                    "default": 0.5
                  },
                  "perspective": {
                    "type": "number",
                    "description": "Perspective strength (0.0 = no perspective, 1.0 = maximum narrowing toward top)",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "default": 0.7
                  },
                  "slant": {
                    "type": "number",
                    "description": "Text radial slant angle in degrees (characters lean toward center)",
                    "minimum": 0.0,
                    "maximum": 90.0,
                    "default": 60.0
                  },
                  "fade_top": {
                    "type": "number",
                    "description": "Fade start position from top (0.0 = fade from very top, 1.0 = no fade)",
                    "minimum": 0.0,
                    "maximum": 1.0,
                    "default": 0.3
                  },
                  "text_color": {
                    "type": "integer",
                    "description": "Text brightness (1-255)",
                    "minimum": 1,
                    "maximum": 255,
                    "default": 255
                  },
                  "line_spacing": {
                    "type": "integer",
                    "description": "Pixels between text lines",
                    "minimum": 4,
                    "maximum": 20,
                    "default": 8
                  },
                  "loop": {
                    "type": "boolean",
                    "description": "Loop the entire sequence when complete",
                    "default": true
                  },
                  "pause_at_end": {
                    "type": "number",
                    "description": "Seconds to pause after crawl completes before looping",
                    "minimum": 0.0,
                    "maximum": 30.0,
                    "default": 3.0
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "telegram" } }, "required": ["type"] },
          "then": {
            "properties": {
              "auto_hide": { "$ref": "#/definitions/autoHide" },
              "auth": {
                "type": "object",
                "description": "Telegram API authentication (required)",
                "required": ["api_id", "api_hash", "phone_number"],
                "properties": {
                  "api_id": {
                    "type": "integer",
                    "description": "Telegram API ID from my.telegram.org"
                  },
                  "api_hash": {
                    "type": "string",
                    "description": "Telegram API Hash from my.telegram.org"
                  },
                  "phone_number": {
                    "type": "string",
                    "description": "Phone number in international format (e.g., +1234567890)"
                  },
                  "session_path": {
                    "type": "string",
                    "description": "Path to session file (default: telegram/{api_id}_{phone}.session)"
                  }
                }
              },
              "filters": {
                "type": "object",
                "description": "Message filter settings by chat type",
                "properties": {
                  "private_chats": { "$ref": "#/definitions/telegramChatFilterConfig" },
                  "groups": { "$ref": "#/definitions/telegramChatFilterConfig" },
                  "channels": { "$ref": "#/definitions/telegramChatFilterConfig" }
                }
              },
              "appearance": { "$ref": "#/definitions/telegramAppearanceConfig" }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "telegram_counter" } }, "required": ["type"] },
          "then": {
            "properties": {
              "auth": {
                "type": "object",
                "description": "Telegram API authentication (required)",
                "required": ["api_id", "api_hash", "phone_number"],
                "properties": {
                  "api_id": {
                    "type": "integer",
                    "description": "Telegram API ID from my.telegram.org"
                  },
                  "api_hash": {
                    "type": "string",
                    "description": "Telegram API Hash from my.telegram.org"
                  },
                  "phone_number": {
                    "type": "string",
                    "description": "Phone number in international format (e.g., +1234567890)"
                  },
                  "session_path": {
                    "type": "string",
                    "description": "Path to session file (default: telegram/{api_id}_{phone}.session)"
                  }
                }
              },
              "filters": {
                "type": "object",
                "description": "Message filter settings by chat type (independent from telegram widget)",
                "properties": {
                  "private_chats": { "$ref": "#/definitions/telegramChatFilterConfig" },
                  "groups": { "$ref": "#/definitions/telegramChatFilterConfig" },
                  "channels": { "$ref": "#/definitions/telegramChatFilterConfig" }
                }
              },
              "mode": {
                "type": "string",
                "enum": ["badge", "text"],
                "description": "Display mode: badge (Telegram paper airplane icon) or text (formatted text with tokens)",
                "default": "badge"
              },
              "badge": {
                "type": "object",
                "description": "Badge mode settings",
                "properties": {
                  "blink": {
                    "type": "string",
                    "enum": ["never", "always", "progressive"],
                    "description": "Blink mode: never (no blinking), always (constant 2Hz blink), progressive (1-10Hz based on unread count)",
                    "default": "never"
                  },
                  "colors": {
                    "type": "object",
                    "description": "Badge icon colors",
                    "properties": {
                      "foreground": {
                        "type": "integer",
                        "description": "Icon foreground color (0-255, or -1 for none)",
                        "minimum": -1,
                        "maximum": 255,
                        "default": 255
                      },
                      "background": {
                        "type": "integer",
                        "description": "Icon background color (0-255, or -1 for none)",
                        "minimum": -1,
                        "maximum": 255,
                        "default": 0
                      }
                    }
                  }
                }
              },
              "text": {
                "allOf": [
                  { "$ref": "#/definitions/textObject" },
                  {
                    "properties": {
                      "format": {
                        "description": "Format string with tokens: {icon}, {unread}/{total}, {mentions}, {reactions}, {private}, {groups}, {channels}, {muted}, {private_muted}, {groups_muted}, {channels_muted}",
                        "default": "{unread} unread"
                      },
                      "size": { "default": 16 }
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "hacker_code" } }, "required": ["type"] },
          "then": {
            "properties": {
              "hacker_code": {
                "type": "object",
                "description": "Hacker code widget settings - procedurally generated code with typewriter effect",
                "properties": {
                  "style": {
                    "type": "string",
                    "description": "Code generation style",
                    "enum": ["c", "asm", "mixed"],
                    "default": "c"
                  },
                  "typing_speed": {
                    "oneOf": [
                      {
                        "type": "integer",
                        "description": "Fixed characters per second",
                        "minimum": 1,
                        "maximum": 500
                      },
                      {
                        "type": "object",
                        "description": "Random range for characters per second (new speed picked each line)",
                        "properties": {
                          "min": {
                            "type": "integer",
                            "description": "Minimum characters per second",
                            "minimum": 1,
                            "maximum": 500
                          },
                          "max": {
                            "type": "integer",
                            "description": "Maximum characters per second",
                            "minimum": 1,
                            "maximum": 500
                          }
                        },
                        "required": ["min", "max"]
                      }
                    ],
                    "description": "Characters per second - either a fixed integer or an object {min, max} for random range",
                    "default": 50
                  },
                  "line_delay": {
                    "type": "integer",
                    "description": "Milliseconds pause at end of each line",
                    "minimum": 0,
                    "maximum": 5000,
                    "default": 200
                  },
                  "show_cursor": {
                    "type": "boolean",
                    "description": "Show blinking cursor at typing position",
                    "default": true
                  },
                  "cursor_blink_ms": {
                    "type": "integer",
                    "description": "Cursor blink interval in milliseconds",
                    "minimum": 100,
                    "maximum": 2000,
                    "default": 500
                  },
                  "indent_size": {
                    "type": "integer",
                    "description": "Spaces per indent level",
                    "minimum": 1,
                    "maximum": 8,
                    "default": 2
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
