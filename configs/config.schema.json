{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://steelclock.local/config.schema.json",
  "title": "SteelClock Configuration",
  "description": "Configuration schema for SteelClock v2 - display manager for SteelSeries devices",
  "type": "object",
  "required": ["display", "widgets"],
  "properties": {
    "schema_version": {
      "type": "integer",
      "description": "Schema version (2 for this schema)",
      "const": 2
    },
    "game_name": {
      "type": "string",
      "description": "Internal game name for GameSense registration",
      "default": "STEELCLOCK"
    },
    "game_display_name": {
      "type": "string",
      "description": "Display name shown in SteelSeries GG",
      "default": "SteelClock"
    },
    "refresh_rate_ms": {
      "type": "integer",
      "description": "Display refresh rate in milliseconds. GameSense: min 100ms (10Hz). Direct: min 30ms (33Hz).",
      "minimum": 30,
      "default": 100
    },
    "unregister_on_exit": {
      "type": "boolean",
      "description": "Unregister from GameSense API on exit (may cause timeout)",
      "default": false
    },
    "deinitialize_timer_ms": {
      "type": "integer",
      "description": "Timeout for game deactivation after last event (1000-60000ms)",
      "minimum": 1000,
      "maximum": 60000
    },
    "backend": {
      "type": "string",
      "description": "Backend: 'gamesense' (requires SteelSeries GG), 'direct' (USB HID), 'any' (try gamesense, fallback to direct)",
      "enum": ["gamesense", "direct", "any"],
      "default": "gamesense"
    },
    "direct_driver": {
      "type": "object",
      "description": "Direct USB HID driver configuration",
      "properties": {
        "vid": {
          "type": "string",
          "description": "USB Vendor ID in hex (e.g., '1038'). Auto-detect if omitted.",
          "pattern": "^[0-9A-Fa-f]{1,4}$"
        },
        "pid": {
          "type": "string",
          "description": "USB Product ID in hex (e.g., '1612'). Auto-detect if omitted.",
          "pattern": "^[0-9A-Fa-f]{1,4}$"
        },
        "interface": {
          "type": "string",
          "description": "USB interface identifier",
          "default": "mi_01"
        }
      }
    },
    "display": {
      "type": "object",
      "description": "Physical display configuration",
      "required": ["width", "height"],
      "properties": {
        "width": {
          "type": "integer",
          "description": "Display width in pixels",
          "default": 128
        },
        "height": {
          "type": "integer",
          "description": "Display height in pixels",
          "default": 40
        },
        "background": {
          "type": "integer",
          "description": "Display background color (0=black, 255=white)",
          "minimum": 0,
          "maximum": 255,
          "default": 0
        }
      }
    },
    "defaults": {
      "type": "object",
      "description": "Default values inherited by all widgets",
      "properties": {
        "colors": {
          "type": "object",
          "description": "Named colors that widgets can reference with @name syntax",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0,
            "maximum": 255
          }
        },
        "text": { "$ref": "#/definitions/textObject" },
        "update_interval": {
          "type": "number",
          "description": "Default update interval in seconds",
          "minimum": 0.01,
          "default": 1.0
        }
      }
    },
    "widgets": {
      "type": "array",
      "description": "Array of widget configurations",
      "items": { "$ref": "#/definitions/widget" }
    }
  },
  "definitions": {
    "position": {
      "type": "object",
      "description": "Widget position and size",
      "required": ["x", "y", "w", "h"],
      "properties": {
        "x": { "type": "integer", "description": "X coordinate", "minimum": 0 },
        "y": { "type": "integer", "description": "Y coordinate" },
        "w": { "type": "integer", "description": "Width in pixels", "minimum": 1 },
        "h": { "type": "integer", "description": "Height in pixels", "minimum": 1 },
        "z": { "type": "integer", "description": "Z-order (higher = on top)", "default": 0 }
      }
    },
    "style": {
      "type": "object",
      "description": "Widget visual styling",
      "properties": {
        "background": {
          "type": "integer",
          "description": "Background color (-1=transparent, 0-255=grayscale)",
          "minimum": -1,
          "maximum": 255,
          "default": 0
        },
        "border": {
          "type": "integer",
          "description": "Border: -1=disabled, 0-255=enabled with that color",
          "minimum": -1,
          "maximum": 255,
          "default": -1
        },
        "padding": {
          "type": "integer",
          "description": "Padding from widget edges in pixels",
          "minimum": 0,
          "default": 0
        }
      }
    },
    "textObject": {
      "type": "object",
      "description": "Text rendering properties",
      "properties": {
        "format": { "type": "string", "description": "Format string (widget-specific)" },
        "font": { "type": "string", "description": "Font name or TTF path" },
        "size": { "type": "integer", "description": "Font size in pixels", "minimum": 1, "default": 10 },
        "align": {
          "type": "object",
          "properties": {
            "h": { "type": "string", "enum": ["left", "center", "right"], "default": "center" },
            "v": { "type": "string", "enum": ["top", "center", "bottom"], "default": "center" }
          }
        },
        "unit": { "type": "string", "description": "Display unit (widget-specific)" }
      }
    },
    "autoHide": {
      "type": "object",
      "description": "Auto-hide behavior",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable auto-hide", "default": false },
        "timeout": { "type": "number", "description": "Seconds before hiding", "minimum": 0.1, "default": 2.0 },
        "on_silence": { "type": "boolean", "description": "Hide on audio silence (audio widgets)", "default": false },
        "silence_time": { "type": "number", "description": "Silence duration before hiding", "minimum": 0.1, "default": 2.0 }
      }
    },
    "widget": {
      "type": "object",
      "required": ["type", "position"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["clock", "cpu", "memory", "network", "disk", "keyboard", "keyboard_layout", "volume", "volume_meter", "audio_visualizer", "doom"]
        },
        "enabled": { "type": "boolean", "default": true },
        "position": { "$ref": "#/definitions/position" },
        "style": { "$ref": "#/definitions/style" },
        "update_interval": { "type": "number", "description": "Update interval in seconds", "minimum": 0.01 },
        "text": { "$ref": "#/definitions/textObject" },
        "auto_hide": { "$ref": "#/definitions/autoHide" }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "clock" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "analog"], "default": "text" },
              "analog": {
                "type": "object",
                "properties": {
                  "show_seconds": { "type": "boolean", "default": true },
                  "show_ticks": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "face": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "hour": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "minute": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "second": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "cpu" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "properties": {
                  "history": { "type": "integer", "minimum": 2, "default": 60 },
                  "filled": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "arc": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              },
              "per_core": {
                "type": "object",
                "properties": {
                  "enabled": { "type": "boolean", "default": false },
                  "margin": { "type": "integer", "minimum": 0, "default": 0 },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "memory" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "properties": {
                  "history": { "type": "integer", "minimum": 2, "default": 60 },
                  "filled": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "arc": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "ticks": { "type": "integer", "minimum": 0, "maximum": 255, "default": 150 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "network" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "graph", "gauge"], "default": "bar" },
              "interface": { "type": "string" },
              "max_speed_mbps": { "type": "number", "default": 100 },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "rx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 128 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "properties": {
                  "history": { "type": "integer", "minimum": 2, "default": 60 },
                  "filled": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "rx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 128 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "rx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "tx": { "type": "integer", "minimum": 0, "maximum": 255, "default": 128 },
                      "rx_needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "tx_needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 180 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "disk" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "graph"], "default": "bar" },
              "disk": { "type": ["string", "null"] },
              "max_speed_mbps": { "type": "number", "default": -1 },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "read": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "write": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "graph": {
                "type": "object",
                "properties": {
                  "history": { "type": "integer", "minimum": 2, "default": 60 },
                  "filled": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "read": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "write": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "volume" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "gauge", "triangle"], "default": "bar" },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "gauge": {
                "type": "object",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "arc": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 },
                      "needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              },
              "triangle": {
                "type": "object",
                "properties": {
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "volume_meter" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["text", "bar", "gauge"], "default": "bar" },
              "bar": {
                "type": "object",
                "properties": {
                  "direction": { "type": "string", "enum": ["horizontal", "vertical"], "default": "horizontal" },
                  "border": { "type": "boolean", "description": "Draw border around bars", "default": false }
                }
              },
              "gauge": {
                "type": "object",
                "properties": {
                  "show_ticks": { "type": "boolean", "default": true }
                }
              },
              "stereo": {
                "type": "object",
                "properties": {
                  "enabled": { "type": "boolean", "default": false },
                  "left_color": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                  "right_color": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                }
              },
              "metering": {
                "type": "object",
                "properties": {
                  "db_scale": { "type": "boolean", "default": false },
                  "decay_rate": { "type": "number", "minimum": 0.1, "default": 2.0 },
                  "silence_threshold": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.01 }
                }
              },
              "peak": {
                "type": "object",
                "properties": {
                  "enabled": { "type": "boolean", "default": true },
                  "hold_time": { "type": "number", "minimum": 0.1, "default": 1.0 }
                }
              },
              "clipping": {
                "type": "object",
                "properties": {
                  "enabled": { "type": "boolean", "default": true },
                  "threshold": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.99 },
                  "color": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                }
              },
              "colors": {
                "type": "object",
                "properties": {
                  "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                  "arc": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 },
                  "needle": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "audio_visualizer" } }, "required": ["type"] },
          "then": {
            "properties": {
              "mode": { "type": "string", "enum": ["spectrum", "oscilloscope"], "default": "spectrum" },
              "spectrum": {
                "type": "object",
                "properties": {
                  "bars": { "type": "integer", "minimum": 8, "maximum": 128, "default": 32 },
                  "scale": { "type": "string", "enum": ["logarithmic", "linear"], "default": "logarithmic" },
                  "style": { "type": "string", "enum": ["bars", "line"], "default": "bars" },
                  "smoothing": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.7 },
                  "frequency_compensation": { "type": "boolean", "default": false },
                  "dynamic_scaling": {
                    "type": "object",
                    "properties": {
                      "strength": { "type": "number", "minimum": 0, "maximum": 2, "default": 0 },
                      "window": { "type": "number", "minimum": 0.1, "maximum": 5, "default": 0.5 }
                    }
                  },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "left": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "right": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "oscilloscope": {
                "type": "object",
                "properties": {
                  "style": { "type": "string", "enum": ["line", "filled"], "default": "line" },
                  "samples": { "type": "integer", "minimum": 32, "maximum": 512, "default": 128 },
                  "colors": {
                    "type": "object",
                    "properties": {
                      "fill": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "left": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                      "right": { "type": "integer", "minimum": 0, "maximum": 255, "default": 200 }
                    }
                  }
                }
              },
              "peak": {
                "type": "object",
                "properties": {
                  "enabled": { "type": "boolean", "default": true },
                  "hold_time": { "type": "number", "minimum": 0.1, "default": 1.0 }
                }
              },
              "channel": { "type": "string", "enum": ["mono", "stereo_combined", "stereo_separated"], "default": "stereo_combined" }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "keyboard" } }, "required": ["type"] },
          "then": {
            "properties": {
              "indicators": {
                "type": "object",
                "properties": {
                  "caps": {
                    "type": "object",
                    "properties": {
                      "on": { "type": "string", "default": "C" },
                      "off": { "type": "string", "default": "c" }
                    }
                  },
                  "num": {
                    "type": "object",
                    "properties": {
                      "on": { "type": "string", "default": "N" },
                      "off": { "type": "string", "default": "n" }
                    }
                  },
                  "scroll": {
                    "type": "object",
                    "properties": {
                      "on": { "type": "string", "default": "S" },
                      "off": { "type": "string", "default": "s" }
                    }
                  }
                }
              },
              "layout": {
                "type": "object",
                "properties": {
                  "spacing": { "type": "integer", "minimum": 0, "default": 3 },
                  "separator": { "type": "string", "default": "" }
                }
              },
              "colors": {
                "type": "object",
                "properties": {
                  "on": { "type": "integer", "minimum": 0, "maximum": 255, "default": 255 },
                  "off": { "type": "integer", "minimum": 0, "maximum": 255, "default": 100 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "keyboard_layout" } }, "required": ["type"] },
          "then": {
            "properties": {
              "format": { "type": "string", "enum": ["iso639-1", "iso639-2", "full"], "default": "iso639-1" }
            }
          }
        },
        {
          "if": { "properties": { "type": { "const": "doom" } }, "required": ["type"] },
          "then": {
            "properties": {
              "wad": { "type": "string", "default": "doom1.wad" }
            }
          }
        }
      ]
    }
  }
}
